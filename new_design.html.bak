<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>字节Trae Win+Mac版全量上线</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Microsoft YaHei', sans-serif;
    }

    body {
      background-color: #f5f5f5;
      padding: 15px;
      width: 600px;
      height: 500px;
      overflow-y: auto;
    }

    .container {
      max-width: 570px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .input-section {
      margin-bottom: 30px;
    }

    textarea {
      width: 100%;
      height: 100px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      resize: none;
      font-size: 16px;
      margin-bottom: 20px;
      transition: border-color 0.3s;
    }

    textarea:focus {
      outline: none;
      border-color: #4a90e2;
      box-shadow: 0 0 5px rgba(74, 144, 226, 0.3);
    }

    .style-section {
      margin-bottom: 30px;
    }

    .style-options {
      display: flex;
      gap: 20px;
    }

    .style-option {
      flex: 1;
      text-align: center;
      padding: 20px;
      border: 2px solid #eee;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .style-option:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .style-option.active {
      border-color: #4a90e2;
      background-color: rgba(74, 144, 226, 0.05);
    }

    .style-option h3 {
      margin-bottom: 10px;
      color: #333;
    }

    .style-preview {
      height: 100px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }

    .simple-white {
      background-color: #fff;
      border: 1px solid #eee;
    }

    .dark {
      background-color: #222;
      color: #fff;
    }

    .artistic {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      color: #fff;
    }

    .button-group {
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background-color: #4a90e2;
      color: white;
    }

    .btn-primary:hover {
      background-color: #357abd;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background-color: #5cb85c;
      color: white;
    }

    .btn-secondary:hover {
      background-color: #4cae4c;
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="input-section">
      <textarea placeholder="字节Trae Win+Mac版全量上线，免费无限量使用Claude，开启AI编程新时代！"></textarea>
    </div>

    <div class="style-section">
      <div class="style-options">
        <div class="style-option active">
          <div class="style-preview simple-white">
            <h3>简约白</h3>
          </div>
          <h3>简约白</h3>
        </div>
        <div class="style-option">
          <div class="style-preview dark">
            <h3>暗夜</h3>
          </div>
          <h3>暗夜</h3>
        </div>
        <div class="style-option">
          <div class="style-preview artistic">
            <h3>文艺</h3>
          </div>
          <h3>文艺</h3>
        </div>
      </div>
    </div>

    <div class="button-group">
      <button class="btn btn-primary" id="generate-btn">生成图片</button>
      <button class="btn btn-secondary" id="save-btn" disabled>保存图片</button>
      <button class="btn btn-primary" id="ai-summarize-btn">AI总结</button>
    </div>
  </div>

  <canvas id="preview-canvas" style="display: none; max-width: 100%; margin-top: 20px;"></canvas>

  <script>
    // 获取DOM元素
    const textarea = document.querySelector('textarea');
    const generateBtn = document.getElementById('generate-btn');
    const saveBtn = document.getElementById('save-btn');
    const aiSummarizeBtn = document.getElementById('ai-summarize-btn');
    const previewCanvas = document.getElementById('preview-canvas');
    let selectedStyle = 'simple-white';
    let generatedImageData = null;

    // 样式选择功能
    const styleOptions = document.querySelectorAll('.style-option');
    styleOptions.forEach(option => {
      option.addEventListener('click', () => {
        styleOptions.forEach(opt => opt.classList.remove('active'));
        option.classList.add('active');
        selectedStyle = option.querySelector('.style-preview').classList[1];
      });
    });

    // AI总结功能
    aiSummarizeBtn.addEventListener('click', async () => {
      const text = textarea.value.trim();
      if (!text) {
        alert('请输入要总结的文字内容');
        return;
      }

      aiSummarizeBtn.disabled = true;
      aiSummarizeBtn.textContent = '正在总结...';

      try {
        const response = await fetch('http://localhost:3000/api/summarize', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ text })
        });

        if (!response.ok) {
          throw new Error('API请求失败');
        }

        const data = await response.json();
        textarea.value = data.summary;
      } catch (error) {
        console.error('AI总结失败:', error);
        alert('生成总结时出错，请稍后重试');
      } finally {
        aiSummarizeBtn.disabled = false;
        aiSummarizeBtn.textContent = 'AI总结';
      }
    });

    // 生成图片功能
    generateBtn.addEventListener('click', () => {
      const text = textarea.value.trim();
      if (!text) {
        alert('请输入要转换的文字内容');
        return;
      }

      const ctx = previewCanvas.getContext('2d');
      const width = 800;
      const height = 400;

      previewCanvas.width = width;
      previewCanvas.height = height;
      ctx.clearRect(0, 0, width, height);

      // 设置背景样式
      switch (selectedStyle) {
        case 'simple-white':
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0, 0, width, height);
          ctx.strokeStyle = '#eeeeee';
          ctx.lineWidth = 2;
          ctx.strokeRect(1, 1, width - 2, height - 2);
          ctx.fillStyle = '#333333';
          break;

        case 'dark':
          ctx.fillStyle = '#222222';
          ctx.fillRect(0, 0, width, height);
          ctx.fillStyle = '#ffffff';
          break;

        case 'artistic':
          const gradient = ctx.createLinearGradient(0, 0, width, height);
          gradient.addColorStop(0, '#f6d365');
          gradient.addColorStop(1, '#fda085');
          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, width, height);
          ctx.fillStyle = '#ffffff';
          break;
      }

      // 绘制文本
      ctx.font = '24px Microsoft YaHei';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';

      const maxWidth = width - 80;
      const words = text.split('');
      let line = '';
      const lines = [];

      for (let i = 0; i < words.length; i++) {
        const testLine = line + words[i];
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && i > 0) {
          lines.push(line);
          line = words[i];
        } else {
          line = testLine;
        }
      }
      lines.push(line);

      const lineHeight = 36;
      const totalHeight = lines.length * lineHeight;
      const startY = (height - totalHeight) / 2;

      lines.forEach((line, index) => {
        ctx.fillText(line, width / 2, startY + index * lineHeight);
      });

      previewCanvas.style.display = 'block';
      saveBtn.disabled = false;
      generatedImageData = previewCanvas.toDataURL('image/png');
    });

    // 保存图片功能
    saveBtn.addEventListener('click', () => {
      if (!generatedImageData) return;

      const link = document.createElement('a');
      link.download = '金句图片.png';
      link.href = generatedImageData;
      link.click();
    });
  </script>
</body>
</html>